<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>React Tutorial</title>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.28.3/react-bootstrap.min.js"></script>-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Londrina+Sketch|Monofett|Londrina+Shadow' rel='stylesheet' type='text/css'>
    <script src="script/react.js"></script>
    <script src="script/react-dom.js"></script>
    <script src="script/browser.js"></script>
    <script src="script/jquery.min.js"></script>
    <script src="script/marked.min.js"></script>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
       
    <!--<link rel=stylesheet type="text/css" href="css/main.css">-->
  </head>
  <body>
      <div id="content" class="container"></div>
      
      <script type="text/babel">

      var SearchBox = React.createClass({
        handleCommandSubmit: function(commands){
          var data = this.state.data;

          $.ajax({
            url: this.props.url,
            dataType: 'json',
            type: 'post',
            cache: false,
            data: commands,
            success: function(data){
              var data2 = JSON.parse(data);
              console.log(data2.slice(0, 1));
              //console.log(data);
              this.setState({data:data2});
              //console.log(data);
            }.bind(this),
            error: function(xhr, status, err){
              this.setState({data:JSON.parse(data)});
              
              console.log(this.props.url, status, err.toString());
            }.bind(this)
          });
        },
        getInitialState: function(){
          return {data:[]};
        },
        render: function(){
          return (
            <div className="search-box">
              <SearchForm onCommandSubmit={this.handleCommandSubmit}/>
              {/*<div className="result-box">
                {this.state.data}
              </div>*/}
              <RecordList data={this.state.data} />
            </div>

          );
        }
      });
      var RecordList = React.createClass({
      render: function(){
        var RecordNodes = this.props.data.map(function(record){
          return (
            <Record title={record.title} id={record.id} key={record.id}>
            </Record>
          );
        });

        return (
          <div className="commentList">
            {RecordNodes}
          </div>
        );
      }
      });

    var Record = React.createClass({
      render: function(){
        var link = "http://www.youtube.com/v/"+this.props.id;

        return (
          <div className="record">
            <h3 className="recordAuthor">
              {this.props.title}
            </h3>
            <object width="420" height="315"
              data={link}>
            </object>
          </div>
        );
      }
    });


      var SearchForm = React.createClass({
        handleCommandChange: function(event){
          this.setState({query_text: event.target.value});
        },
        handleOuputListChange: function(event){
          this.setState({outputList: event.target.value});
        },
        handleCaseInsensitiveChanged: function(event){
          //event.preventDefault();
          if(this.state.caseInsensitive == "+i")
          {
            this.setState({caseInsensitive: "-i"});
            //event.target.checked;
          }else {
            this.setState({caseInsensitive: "+i"});
          }
          //var radio = event.target.value;
          //console.log(event.target.value);
        },
        handleSubmit: function(event){
          event.preventDefault();
          var query = this.state.query_text.trim();
          var list = this.state.outputList;
          var checkbox = this.state.caseInsensitive;
          if(!list){
            list = 0;
          }
          if(!query){
            return ;
          }
          this.props.onCommandSubmit({query:query, list:list, checkbox: checkbox});
          this.setState({query:query, list:list, checkbox: checkbox});
        },
        getInitialState: function(){
          return {
            query_text: '',
            query: '',
            caseInsensitive: '+i'
          }
        },
        render: function(){
          return (
            <form className="search-form col-md-6 col-md-offset-3" onSubmit={this.handleSubmit}>
              <h1>my rgrep:</h1>
              <div className="row">
                <div className="col-xs-6 col-xs-offset-3">
                  <input type="text" placeholder="search query" onChange={this.handleCommandChange} className="form-control"/>
                </div>
              </div>
              <div className="row">
                <div className="col-xs-3">
                  <input type="number" min="0" placeholder="-L" onChange={this.handleOuputListChange} className="form-control"/>
                </div>
              </div>
              
              <div className="radio">
                  <label>
                    <input type="checkbox" name="optionsRadios" id="optionsRadios1" value={this.state.caseInsensitive} onChange={this.handleCaseInsensitiveChanged}/>
                    Case Insensitive
                  </label>
              </div>



              <br/>
              <input type="submit" value="query" className="btn btn-default"/>
              <br/>
              Commands: {this.state.query || ''}
              <br/>
              pinrt list: {this.state.list || ''}
              <br/>
              radio : {this.state.checkbox || ''}
            </form>
          );
        }
      });

      ReactDOM.render(
        <SearchBox url="/search" />,
        document.getElementById('content')
      );
      </script>
  </body>
</html>
